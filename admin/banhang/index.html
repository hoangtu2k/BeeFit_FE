<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center header-bh">

  <div class="row">
    <div class="col-lg-12">
      <button ng-click="togglePopup()" class="btn btn-primary" title="Tìm kiếm hàng hóa"><i
          class="bi bi-search"></i></button>
      <button ng-click="webcam()" class="btn btn-primary"><i class="fa-solid fa-qrcode"></i> QR </button>
      <span ng-if="listBill.length < 5">
        <span ng-repeat="bill in pager.items">
          <button ng-click="choose(bill.code,bill.id)" style="margin: 2px 1px; width: 100px;"
            class="btn btn-primary">{{bill.code}}</button>
        </span>
      </span>
      <span ng-if="listBill.length > 4">
        <button ng-click="pager.prev()" type="button" class="btn btn-primary"><i
            class="fa-solid fa-angle-left"></i></button>
        <span ng-repeat="bill in pager.items">
          <button ng-click="choose(bill.code,bill.id)" style="margin: 2px 1px; width: 150px;"
            class="btn btn-primary">{{bill.code}}</button>
        </span>
        <button ng-click="pager.next()" type="button" class="btn btn-primary"><i
            class="fa-solid fa-angle-right"></i></button>
      </span>
      <button ng-click="addbill()" class="btn btn-primary">+</button>

    </div>
  </div>

  <nav class="header-nav ms-auto">
    <ul class="d-flex align-items-center">

      <li class="nav-item dropdown pe-3">

        <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
          <img ng-if="user.image == null" src="./assets/img/user-1.jpg" alt="Profile" class="rounded-circle">
          <img ng-if="user.image != null" src="{{user.image}}" alt="" class="rounded-circle">
          <span class="d-none d-md-block dropdown-toggle ps-2">{{user.fullname}}</span>
        </a><!-- End Profile Iamge Icon -->

        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
          <li class="dropdown-header">
            <h6>{{user.fullname}}</h6>
            <span> {{user.role.name}} </span>
          </li>
          <li>
            <hr class="dropdown-divider">
          </li>

          <li>
            <a class="dropdown-item d-flex align-items-center" href="#/profile">

              <span>Thông tin người dùng</span>
            </a>
          </li>
          <li>
            <hr class="dropdown-divider">
          </li>

          <li>
            <a class="dropdown-item d-flex align-items-center" href="#/product/view">

              <span>Quản lý</span>
            </a>
          </li>

          <li>
            <hr class="dropdown-divider">
          </li>

          <li>
            <a class="dropdown-item d-flex align-items-center" ng-click="logout()" href>

              <span>Đăng xuất</span>
            </a>
          </li>

        </ul><!-- End Profile Dropdown Items -->
      </li><!-- End Profile Nav -->

    </ul>
  </nav><!-- End Icons Navigation -->

</header><!-- End Header -->

<!-- ======= Main ======= -->
<main id="main" class="main" style="margin: 60px 0 0 0; padding: 20px 20px;">
  <section class="section dashboard" id="chitiet" style="display: none;">
    <div class="row">

      <!-- Left side columns -->
      <div class="col-lg-9">
        <div class="row">

          <div class="col-lg-12">

            <div class="card">
              <div class="card-body">

                <!-- cart -->
                <table class="table">
                  <thead>
                    <th>Mã sản phẩm</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Tổng cộng</th>
                  </thead>
                  <tbody>
                    <tr ng-if="listItem.length > 0" ng-repeat="cart in listItem">
                      <td>{{ cart.product.code }}</td>
                      <td>{{ cart.product.name }}
                        <div class="cart__meta-text">
                          Màu:
                          <span ng-repeat="color in listColor">
                            <span ng-if="color.id == cart.idColor">
                              {{color.name}}
                            </span>
                          </span>
                          <br>
                          Kích Thước:
                          <span ng-repeat="size in listSize">
                            <span ng-if="size.id == cart.idSize">
                              {{size.name}}
                            </span>
                          </span>
                          <br>
                        </div>
                      </td>
                      <td>
                        <i class="bi bi-dash-circle" ng-click="giam(cart.id)"></i>
                        <input id="quantity{{cart.id}}" type="number" min="1" value="{{cart.quantity}}"
                          class="table-quantity text-center">
                        <i class="bi bi-plus-circle" ng-click="tang(cart.id)"></i>
                      </td>
                      <td>{{cart.product.price | currency:'':0}} VNĐ</td>
                      <td>{{cart.product.price * cart.quantity | currency:'':0}} VNĐ</td>
                      <td>
                        <a href="" ng-click="deleteBillDetail(cart.id)"><i class="bi bi-trash"></i></a>
                      </td>
                    </tr>
                    <tr ng-if="listItem.length == 0">
                      <td colspan="13">
                        <div style="text-align: center;">
                          <div><img style="width: 80px; height: 80px;" src="././assets/img/box.png"></div>
                          <h4>Không có sản phẩm nào</h4>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

          </div>

        </div>
      </div>

      <!-- End Left side columns -->
      <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
      <!-- Right side columns -->

      <div class="col-lg-3">
        <div class="row">

          <div class="col-lg-12">

            <div class="card">

              <div class="card-body">

                <div class="card-title" style="padding-bottom: 5px;">
                  Có {{listBill.length}} đơn hàng đang chờ <br>
                  Đơn hàng: {{hoadon.code}}
                </div>

                <div class="card-title" style="padding-top: 5px;">
                  Thông tin giao hàng
                </div>

                <div>
                  <span>Hình thức mua hàng</span>

                  <div class="radio-button">
                    <input type="radio" id="hinhThuc1" ng-click="hinhThucMuaHang();chondiachi()" value="hinhThuc1"
                      name="radio-group" checked>
                    <label for="hinhThuc1"><i class="fa-solid fa-store"></i> Tại quầy</label>
                    <input type="radio" id="hinhThuc2" ng-click="hinhThucMuaHang();tinhPhiShip();chondiachi()"
                      value="hinhThuc2" name="radio-group">
                    <label for="hinhThuc2"><i class="fa-solid fa-earth-americas"></i> Online</label>
                  </div>

                  <div>
                    <label for="">Khách hàng</label>
                    <select class="form-select kh-select" ng-click="chondiachi()" id="khachhang">
                      <option value="0">Khách lẻ</option>
                      <option ng-repeat="kh in listCustomer" value="{{kh.id}}">{{kh.fullname}} ({{kh.code}})</option>
                    </select>
                    <div id="diachi" style="display: none;" class="custom-radio">
                      <input ng-click="chondiachi1()" type="radio" id="diachichon" name="diachi" checked>
                      <label for="diachichon">Địa chỉ chọn</label>
                      <input ng-click="chondiachi1()" type="radio" id="diachicosan" name="diachi">
                      <label for="diachicosan">Địa chỉ có sẵn</label>
                    </div>
                    <div id="diachichon1" style="display: none;">
                      Địa chỉ giao hàng
                      <select class="form-select" id="diachiCustomer" ng-click="doidiachi()">
                        <option ng-repeat="add in listAddress" value="{{add.id}}">{{add.fullname}} - {{add.phone}} |
                          {{add.address}}, {{add.wardName}}, {{add.districtName}}, {{add.cityName}}</option>
                      </select>
                    </div>
                    <div id="diachichon2" style="display: none;">

                      <div>
                        <label>Tỉnh/TP </label>
                        <select class="form-select" id="tinh" ng-click="getHuyen();getXa();tinhPhiShip()">
                          <option ng-repeat="tinh in listTinh" value="{{tinh.ProvinceID}}">{{tinh.ProvinceName}}
                          </option>
                        </select>
                      </div>
                      <div>
                        <label> Quận/Huyện</label>
                        <select class="form-select" id="huyen" ng-click="getXa();tinhPhiShip()">
                          <option ng-repeat="huyen in listHuyen" value="{{huyen.DistrictID}}">{{huyen.DistrictName}}
                          </option>
                        </select>
                      </div>
                      <div>
                        <label>Xã/Phường </label>
                        <select class="form-select" id="xa" ng-click="tinhPhiShip()">
                          <option ng-repeat="xa in listXa" value="{{xa.WardCode}}">{{xa.WardName}}</option>
                        </select>
                      </div>
                      <div id="nguoimua" style="display: block;">
                        <label for="">Tên người mua</label>
                        <input class="form-control" type="text" id="tennguoimua">
                        <label for="">Số điện thoại</label>
                        <input class="form-control" type="text" id="sodienthoai">
                      </div>
                      <label for="">Địa chỉ cụ thể</label>
                      <textarea class="form-control" type="text" id="diachicuthe" style="display: block;"></textarea>
                    </div>                  
                  </div>

                </div>

                <div>
                  <span>Hình thức thanh toán</span>
                  <div class="radio-button">
                    <input type="radio" id="pay1" name="radio-group1" checked>
                    <label for="pay1"><i class="fa-solid fa-wallet"></i> Tiền mặt</label>
                    <input type="radio" id="pay2" name="radio-group1">
                    <label for="pay2"><i class="fa-solid fa-credit-card"></i> VNPAY</label>
                  </div>

                  <div id="muaonline" style="display: none;">
                    <label for="">Đơn vị vận chuyển</label>
                    <img width="150px" height="75px" src="././assets/img/Logo-GHN.png">
                  </div>

                  <div>
                    <label for="">Ghi chú</label>
                    <textarea class="form-control" id="ghichu"></textarea>
                  </div>
                </div>

                <div>

                  <div class="custom-radio">
                    <input ng-click="magiamgia()" type="radio" id="chuongtrinhkhuyenmaiCheck" name="magiam" checked>
                    <label for="chuongtrinhkhuyenmaiCheck">Chương trình khuyến mãi</label>
            
                    <span id="maGiamGiaKH" style="display: none;">
                      <input ng-click="magiamgia()" type="radio" id="magiamgiaCheck" name="magiam">
                      <label for="magiamgiaCheck">Phiếu giảm giá</label>
                    </span>
                  </div>

                  <div id="magiamgia" style="display: none;">
                    <input class="form-control" style="width: 230px; float: left;" type="text" id="code-coupon"
                      placeholder="Mã giảm giá nếu có...">
                    <button ng-click="apCoupon()" style="padding: 5px; margin-left: 10px; margin-top: 1px; float: right;" class="btn btn-primary">Áp dụng</button>
                  </div>
                  
                  <div id="chuongtrinhkhuyenmai" style="display: block;">
                    <select class="form-select" style="width: 230px;height: 40px; float: left;" id="ctkm">
                      <option ng-repeat="km in listVoucher" value="{{km.Idvoucher}}">{{km.Idvoucher}} - {{km.Name}} | Áp dụng cho hóa đơn</option>
                    </select>
                    <button  ng-click="apCTKM()" style="padding: 5px; margin-left: 10px; margin-top: 2px;" class="btn btn-primary">Áp dụng</button>
                  </div>

                </div>
                
                <br>

                <div class="discount-coupon">

                  <div id="coupon" class="coupon-dec tab-pane active">

                    <div id="voucher" ng-if="checkVoucher == true && voucherIs == false && voucherType === true">
                      {{voucherName}} | Giảm {{discountVoucher}} áp dụng trên trên hóa đơn (- {{voucherGiamGia |
                      currency:'':0}} VNĐ)
                      <button ng-click="removeVoucher()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>
                    </div>
                    <div id="voucher" ng-if="checkVoucher == true && voucherIs == false && voucherType === false">
                      {{voucherName}} | Giảm {{cashVoucher}} áp dụng trên hóa đơn (- {{voucherGiamGia |
                      currency:'':0}} VNĐ)
                      <button ng-click="removeVoucher()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>
                    </div>
                    <div id="voucher" ng-if="checkVoucher == true && voucherIs == true && voucherType === true">
                      {{voucherName}} | Giảm {{discountVoucher}} áp dụng trên trên sản phẩm (- {{voucherGiamGia |
                      currency:'':0}} VNĐ)
                      <button ng-click="removeVoucher()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>

                      <div>Áp dụng cho sản phẩm : </div>
                      <div ng-repeat="sp in listSPVoucher">
                        - [{{sp.productDetail.product.name}} - SKU : {{sp.productDetail.product.code}}]
                      </div>
                    </div>
                    <div id="voucher" ng-if="checkVoucher == true && voucherIs == true && voucherType === false">
                      {{voucherName}} | Giảm tối đa {{cashVoucher}} áp dụng trên sản phẩm (- {{voucherGiamGia |
                      currency:'':0}} VNĐ)
                      <button ng-click="removeVoucher()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>
                      <div>Áp dụng cho sản phẩm : </div>
                      <div ng-repeat="sp in listSPVoucher">
                        - [{{sp.productDetail.product.name}} - SKU : {{sp.productDetail.product.code}}]
                      </div>
                    </div>

                    <div id="voucher1" ng-if="checkCoupon == true && couponType == true">{{couponName}} | Giảm
                      {{discountCoupon}} trên hóa đơn (- {{couponGiamGia | currency:'':0}} VNĐ)
                      <button ng-click="removeCoupon()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>
                    </div>
                    <div id="voucher1" ng-if="checkCoupon == true && couponType == false">{{couponName}} | Giảm
                      {{cashCoupon}}
                      trên hóa đơn (- {{couponGiamGia | currency:'':0}} VNĐ)
                      <button ng-click="removeCoupon()" style="color: rgb(247, 3, 3);border: none;"><i
                          class="fa-solid fa-trash-can"></i></button>
                    </div>

                  </div>
                </div>


  
                <div>
                  <br>
                  <div>
                    <label class="form-label">Tổng tiền : </label>
                    <input value="{{tongTien}}" class="form-control" disabled>
                  </div>
                  <div id="muaonline1" style="display: none;">
                    <label class="form-label">Phí ship : </label>
                    <input value="{{phiShip}}" class="form-control" disabled>
                  </div>
                  <div>
                    <label class="form-label">Giảm giá : </label>
                    <input value="{{giamGia}}" class="form-control" disabled>
                  </div>
                  <div>
                    <label class="form-label">Tổng tiền cần thanh toán :</label>
                    <input value="{{tienThanhToan}}" class="form-control" disabled>
                  </div>
                </div>

                <div style="padding-top: 10px;">
                  <button ng-click="huyhoadon(hoadon.code)" class="btn btn-primary"><i class="fa-solid fa-ban"></i>
                    Hủy</button>
                  <button ng-click="buy(hoadon.code)" class="btn btn-primary"><i
                      class="fa-solid fa-money-check-dollar"></i>
                    Thanh Toán</button>
                </div>
              </div>

            </div>

          </div>

        </div>

      </div>
    </div>

    <!-- End Right side columns -->

    </div>

    <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
    <!-- Tìm sản phẩm -->

    <!-- Tìm sản phẩm -->
    <div class="popup" ng-class="{ 'show': isPopupVisible }">
      <div class="popup-content">
        <!-- Nội dung của popup -->
        <h1>Danh sách sản phẩm </h1>
        <div class="timkiem row">
          <div class="col-lg-7">
            <input class="form-control" id="name" type="text" placeholder="Tìm theo mã hoặc tên giày..">
          </div>
          <div class="col-lg-5">
            <button ng-click="timkiem()" class="btn btn-primary"><i class="fa-solid fa-magnifying-glass"></i></button>
          </div>
        </div>
        <div>
          <div class="row">
            <div class="col-md-6 loc"><label>Màu Sắc</label>
              <select id="mausac" class="form-select" ng-click="timkiem()">
                <option value="">Tất cả màu sắc</option>
                <option ng-repeat="mausac in listColor" value="{{mausac.id}}">
                  {{mausac.name}}</option>
              </select>
            </div>
            <div class="col-md-6 loc"><label>Kích Thước</label>
              <select id="kichthuoc" class="form-select" ng-click="timkiem()">
                <option value="">Tất cả kích thước</option>
                <option ng-repeat="kichthuoc in listSize" value="{{kichthuoc.id}}">
                  Size {{kichthuoc.name}}</option>
              </select>
            </div>
          </div>
          <table class="table">
            <thead class="cart__row cart__header">
              <tr>
                <td colspan="2" class="text-center">Sản Phẩm</td>
                <td class="text-center">Giá Bán</td>
                <td class="text-center">Số lượng còn</td>
              </tr>
            </thead>
            <tbody>
              <tr ng-if="listQuantity.length > 0" ng-repeat="cart in pager1.items" ng-click="themvaogio(cart.id)">
                <td class="cart__image-wrapper cart-flex-item">
                  <span ng-repeat="pro in listPro">
                    <span ng-if="pro.id == cart.idProduct">
                      <span ng-repeat="img in pro.productImages">
                        <span ng-if="img.mainImage == true">
                          <a href="#"><img style="height: 100px;width: 100px;" class="cart__image" src="{{img.url}}"
                              alt=""></a>
                        </span>
                      </span>
                    </span>
                  </span>
                </td>
                <td class="cart__meta small--text-left cart-flex-item">
                  <div class="list-view-item__title">
                    <span ng-repeat="pro in listPro">
                      <span ng-if="pro.id == cart.idProduct">
                        {{pro.name}}
                        <br>
                        SKU : {{pro.code}}
                      </span>
                    </span>
                  </div>
                  <div class="cart__meta-text">
                    Màu:
                    <span ng-repeat="color in listColor">
                      <span ng-if="color.id == cart.idColor">
                        {{color.name}}
                      </span>
                    </span>
                    <br>
                    Kích Thước:
                    <span ng-repeat="size in listSize">
                      <span ng-if="size.id == cart.idSize">
                        {{size.name}}
                      </span>
                    </span>
                    <br>
                  </div>
                </td>
                <td class="text-center">
                  <span ng-repeat="pro in listPro">
                    <span ng-if="pro.id == cart.idProduct">
                      {{pro.price | currency:'':0}} VNĐ
                    </span>
                  </span>
                </td>
                <td class="cart__update-wrapper cart-flex-item text-center">
                  {{cart.quantity > 0 ? cart.quantity : 'Tạm hết'}}
                </td>
              </tr>
              <tr ng-if="listQuantity.length == 0">
                <td colspan="8">Không có sản phẩm nào</td>
              </tr>
            </tbody>
          </table>
          <div class="text-center" ng-if="listQuantity.length > 0">
            <div class="btn-group" role="group" aria-label="Basic outlined example">
              <button ng-click="pager1.first()" type="button" class="btn btn-outline-secondary"><i
                  class="fa-solid fa-angles-left"></i></button>
              <button ng-click="pager1.prev()" type="button" class="btn btn-outline-secondary"><i
                  class="fa-solid fa-angle-left"></i></button>
              <button type="button" class="btn btn-outline-secondary">{{pager1.page+1}}
                of
                {{pager1.count}}</button>
              <button ng-click="pager1.next()" type="button" class="btn btn-outline-secondary"><i
                  class="fa-solid fa-angle-right"></i></button>
              <button ng-click="pager1.last()" type="button" class="btn btn-outline-secondary"><i
                  class="fa-solid fa-angles-right"></i></button>
            </div>
          </div>
        </div>

        <button class="btn btn-primary" ng-click="togglePopup()">Đóng</button>
      </div>
    </div>

    <!-- qr -->
    <div class="popup" ng-class="{ 'show': isSanPhamQR }" id="qrsp">
      <div class="popup-content">
        <!-- Nội dung của popup -->
        <table class="table">
          <thead class="cart__row cart__header">
            <tr>
              <td colspan="2" class="text-center">Sản Phẩm</td>
              <td class="text-center">Giá Bán</td>
              <td class="text-center">Số lượng còn</td>
            </tr>
          </thead>
          <tbody>
            <tr ng-if="listProduct.length > 0" ng-repeat="cart in pager1.items" ng-click="themvaogio(cart.id)">
              <td class="cart__image-wrapper cart-flex-item">
                <span ng-repeat="pro in listPro">
                  <span ng-if="pro.id == cart.idProduct">
                    <span ng-repeat="img in pro.productImages">
                      <span ng-if="img.mainImage == true">
                        <img style="height: 100px;width: 100px;" class="cart__image" src="{{img.url}}"
                          alt="Elastic Waist Dress - Navy / Small">
                      </span>
                    </span>

                  </span>
                </span>
              </td>
              <td class="cart__meta small--text-left cart-flex-item">
                <div class="list-view-item__title">
                  <span ng-repeat="pro in listPro">
                    <span ng-if="pro.id == cart.idProduct">
                      {{pro.name}}
                      <br>
                      SKU : {{pro.code}}
                    </span>
                  </span>
                </div>
                <div class="cart__meta-text">
                  Màu:
                  <span ng-repeat="color in listColor">
                    <span ng-if="color.id == cart.idColor">
                      {{color.name}}
                    </span>
                  </span>
                  <br>
                  Kích Thước:
                  <span ng-repeat="size in listSize">
                    <span ng-if="size.id == cart.idSize">
                      {{size.name}}
                    </span>
                  </span>
                  <br>
                </div>
              </td>
              <td class="text-center">
                <span ng-repeat="pro in listPro">
                  <span ng-if="pro.id == cart.idProduct">
                    {{pro.price | currency:'':0}} VNĐ
                  </span>
                </span>
              </td>
              <td class="cart__update-wrapper cart-flex-item text-center">
                {{cart.quantity > 0 ? cart.quantity : 'Tạm hết'}}
              </td>
            </tr>
            <tr ng-if="listProduct.length == 0">
              <td colspan="8">Không có sản phẩm nào</td>
            </tr>
          </tbody>
        </table>
        <div class="text-center" ng-if="listProduct.length > 0">
          <div class="btn-group" role="group" aria-label="Basic outlined example">
            <button ng-click="pager1.first()" type="button" class="btn btn-outline-secondary"><i
                class="fa-solid fa-angles-left"></i></button>
            <button ng-click="pager1.prev()" type="button" class="btn btn-outline-secondary"><i
                class="fa-solid fa-angle-left"></i></button>
            <button type="button" class="btn btn-outline-secondary">{{pager1.page+1}}
              of
              {{pager1.count}}</button>
            <button ng-click="pager1.next()" type="button" class="btn btn-outline-secondary"><i
                class="fa-solid fa-angle-right"></i></button>
            <button ng-click="pager1.last()" type="button" class="btn btn-outline-secondary"><i
                class="fa-solid fa-angles-right"></i></button>
          </div>
        </div>

        <div style="padding-top: 10px;">
          <button class="btn btn-primary" ng-click="SanPhamQR()">X</button>
        </div>

      </div>
    </div>
    <!-- qr -->
    <div class="popup" ng-class="{ 'show': isQR1 }" id="qr">
      <div class="popup-content2">
        <!-- Nội dung của popup -->
        <h1 class="text-center">Quét QR </h1>
        <div style="width:450px;"></div>
        <video id="video" width="350" height="240" autoplay></video>
        <div id="result" class="text-center"></div>
        <canvas id="canvas" style="display: none;"></canvas>
        <div class="text-center" style="padding-top: 5px;">
          <button class="btn btn-danger" ng-click="webcam()">X</button>
        </div>
      </div>
    </div>

  </section>
</main>
<!-- End #main -->